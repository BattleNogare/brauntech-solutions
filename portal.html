<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>BraunTech Solutions – Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="brauntech.css">

    <!-- YAML Parser (für portal.yaml) -->
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body>

<!-- Rotierende Glow-Kreise (werden per JS gefüllt) -->
<div id="bt-glow-orbits"></div>

<!-- Random-Punkte-Layer (werden per JS gefüllt) -->
<div id="bt-points"></div>

<header class="bt-header">
    <div class="bt-container bt-header-inner">
        <a href="index.html" class="bt-logo">
            <img src="bilder/brauntech-solutions-logo.png" alt="BraunTech Solutions Logo">
        </a>

        <nav class="bt-nav" aria-label="Hauptnavigation">
            <ul class="bt-nav-list">
                <li class="bt-nav-item">
                    <a href="index.html" class="bt-nav-link">Startseite</a>
                </li>

                <li class="bt-nav-item bt-has-dropdown">
                    <a href="product.html" class="bt-nav-link active">Produkte / Dienstleistungen</a>
                    <ul class="bt-dropdown">
                        <li><a href="recycling.html" class="bt-dropdown-link">Recycling</a></li>
                        <li><a href="app-webdesign.html" class="bt-dropdown-link">App / Webdesign</a></li>
                        <li><a href="portal.html" class="bt-dropdown-link active">Portal</a></li>
                        <li><a href="faq.html" class="bt-dropdown-link">FAQ</a></li>
                    </ul>
                </li>

                <li class="bt-nav-item bt-has-dropdown">
                    <a href="about.html" class="bt-nav-link">Über uns</a>
                    <ul class="bt-dropdown">
                        <li><a href="standort.html" class="bt-dropdown-link">Standort</a></li>
                        <li><a href="kontakt.html" class="bt-dropdown-link">Kontakt</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div>
</header>

<main class="bt-main">
    <div class="bt-container bt-portal">
        <h1>Portal</h1>
        <p>Sammlung hilfreicher Links, kuratiert von BraunTech Solutions.</p>

        <!-- Container, den wir per JS aus der portal.yaml füllen -->
        <div id="bt-portal-groups" class="bt-portal-groups">
            <p class="bt-portal-loading">Portal wird geladen …</p>
        </div>
    </div>
</main>

<footer class="bt-footer">
    <div class="bt-container bt-footer-inner">
        <small>© <span id="bt-year"></span> BraunTech Solutions – All systems operational.</small>
        <a href="impressum.html" class="bt-footer-link">Impressum</a>
    </div>
</footer>

<script>
    // Aktuelles Jahr im Footer setzen
    document.getElementById('bt-year').textContent = new Date().getFullYear();

    (function () {
        /* ================================
           RANDOM PUNKTE + PARALLAX
        ================================ */
        const LAYER_COUNT = 8;        // Anzahl Punkt-Ebenen
        const POINTS_PER_LAYER = 22;  // Punkte pro Ebene
        const pointsContainer = document.getElementById("bt-points");
        const pointLayers = [];

        for (let i = 0; i < LAYER_COUNT; i++) {
            const layer = document.createElement("div");
            layer.classList.add("bt-points-layer");

            // leichte Helligkeitsvariation pro Layer
            layer.style.setProperty('--layer-alpha', (0.5 + Math.random() * 0.5).toFixed(2));

            // Delay – sorgt dafür, dass die Ebenen nicht gleichzeitig blinken
            layer.style.animationDelay = (Math.random() * 8).toFixed(2) + "s";

            const gradients = [];
            for (let p = 0; p < POINTS_PER_LAYER; p++) {
                const size = (Math.random() * 6 + 2).toFixed(1); // 2–8px
                const x = (Math.random() * 100).toFixed(1) + "%";
                const y = (Math.random() * 100).toFixed(1) + "%";
                const alpha = (Math.random() * 0.6 + 0.4).toFixed(2);

                gradients.push(
                    `radial-gradient(${size}px ${size}px at ${x} ${y}, rgba(70,255,120,${alpha}), transparent)`
                );
            }

            layer.style.backgroundImage = gradients.join(",");
            // Tiefe für Parallax
            layer.dataset.depth = (0.3 + (i / LAYER_COUNT) * 0.7).toFixed(2); // 0.3–1.0

            pointsContainer.appendChild(layer);
            pointLayers.push(layer);
        }

        // Parallax (Maus + Scroll)
        let mouseX = 0.5;
        let mouseY = 0.5;
        let scrollY = 0;

        window.addEventListener('mousemove', (e) => {
            mouseX = e.clientX / window.innerWidth;
            mouseY = e.clientY / window.innerHeight;
        });

        window.addEventListener('scroll', () => {
            scrollY = window.scrollY || window.pageYOffset || 0;
        });

        function animateParallax() {
            const h = window.innerHeight || 1;
            pointLayers.forEach((layer) => {
                const depth = parseFloat(layer.dataset.depth || 0.5);
                const offsetX = (mouseX - 0.5) * depth * 40;
                const offsetY =
                    (mouseY - 0.5) * depth * 20 +
                    (scrollY / h) * depth * 30;

                layer.style.transform = `translate3d(${offsetX}px, ${offsetY}px, 0)`;
            });
            requestAnimationFrame(animateParallax);
        }
        animateParallax();

        /* ================================
           RANDOM GLOW-KREISE
           - min. 4 Kreise
           - Zufallsanzahl, Position, Größe, Dauer
        ================================ */
        const orbitContainer = document.getElementById("bt-glow-orbits");
        const ORBIT_MIN = 4;
        const ORBIT_MAX = 15;
        const orbitCount = ORBIT_MIN + Math.floor(Math.random() * (ORBIT_MAX - ORBIT_MIN + 1));

        for (let i = 0; i < orbitCount; i++) {
            const orbit = document.createElement("div");
            orbit.classList.add("bt-orbit");

            // Zufällige Größe
            const size = Math.random() * 300 + 260; // 260–560px
            orbit.style.width = size + "px";
            orbit.style.height = size + "px";

            // Zufällige Position irgendwo im Viewport (leicht außerhalb erlaubt)
            const x = Math.random() * 80 + 5;  // 5%–85%
            const y = Math.random() * 80 + 5;  // 5%–85%
            orbit.style.left = x + "%";
            orbit.style.top = y + "%";

            // Zufällige Offsets für die Orbit-Animation
            const offsetX = (Math.random() * 20 - 10).toFixed(1); // -10px bis 10px
            const offsetY = (Math.random() * 20 - 10).toFixed(1); // -10px bis 10px
            orbit.style.setProperty('--orbit-offset-x', offsetX + "px");
            orbit.style.setProperty('--orbit-offset-y', offsetY + "px");

            // Zufällige Animationsdauer & Richtung
            const duration = (Math.random() * 25 + 35).toFixed(1); // 35–60s
            orbit.style.animationDuration = duration + "s";
            orbit.style.animationDirection = Math.random() > 0.5 ? "normal" : "reverse";

            // leichte Variation in der Intensität
            const alphaBorder = (0.2 + Math.random() * 0.25).toFixed(2);
            const alphaGlow = (0.25 + Math.random() * 0.3).toFixed(2);
            orbit.style.borderColor = `rgba(57,255,20,${alphaBorder})`;
            orbit.style.boxShadow = `0 0 18px rgba(57,255,20,${alphaGlow})`;

            orbitContainer.appendChild(orbit);
        }
    })();
</script>

<!-- Portal-Logik: portal.yaml einlesen und Kacheln erzeugen -->
<script>
(function () {
    const portalContainer = document.getElementById('bt-portal-groups');
    if (!portalContainer) return;

    // Hilfsfunktion: eine Kachel erzeugen
    function createTile(tile) {
        const a = document.createElement('a');
        a.className = 'bt-portal-tile';
        a.href = tile.url;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';

        // Hintergrund aus zwei Farben -> Gradient
        if (tile.colorStart && tile.colorEnd) {
            a.style.backgroundImage = `linear-gradient(135deg, ${tile.colorStart}, ${tile.colorEnd})`;
        }

        // Logo
        if (tile.logo) {
            const img = document.createElement('img');
            img.className = 'bt-portal-tile-logo';
            img.src = 'bilder/' + tile.logo;
            img.alt = tile.label || '';
            a.appendChild(img);
        }

        // Text / Bezeichnung
        const label = document.createElement('div');
        label.className = 'bt-portal-tile-label';
        label.textContent = tile.label || '';
        a.appendChild(label);

        return a;
    }

    // Hilfsfunktion: Gruppe erzeugen
    function createGroup(group) {
        const groupEl = document.createElement('section');
        groupEl.className = 'bt-portal-group';

        if (group.title) {
            const h2 = document.createElement('h2');
            h2.className = 'bt-portal-group-title';
            h2.textContent = group.title;
            groupEl.appendChild(h2);
        }

        const grid = document.createElement('div');
        grid.className = 'bt-portal-grid';

        (group.tiles || []).forEach(tile => {
            grid.appendChild(createTile(tile));
        });

        groupEl.appendChild(grid);
        return groupEl;
    }

    function showError(msg) {
        portalContainer.innerHTML = '';
        const p = document.createElement('p');
        p.className = 'bt-portal-error';
        p.textContent = msg;
        portalContainer.appendChild(p);
    }

    // YAML-Konfigurationsdatei laden
    fetch('custom.d/portal.yaml')
        .then(resp => {
            if (!resp.ok) {
                throw new Error('HTTP ' + resp.status);
            }
            return resp.text(); // YAML als Text laden
        })
        .then(text => {
            let data;
            try {
                data = jsyaml.load(text); // YAML -> JS-Objekt
            } catch (e) {
                console.error('YAML-Parsing-Fehler:', e);
                showError('Portal-Konfiguration ist fehlerhaft (YAML).');
                return;
            }

            portalContainer.innerHTML = '';

            if (!data || !Array.isArray(data.groups) || data.groups.length === 0) {
                showError('Keine Portaleinträge konfiguriert.');
                return;
            }

            data.groups.forEach(group => {
                portalContainer.appendChild(createGroup(group));
            });
        })
        .catch(err => {
            console.error('Fehler beim Laden der Portal-Konfiguration:', err);
            showError('Portal-Konfiguration konnte nicht geladen werden.');
        });

})();
</script>

</body>
</html>
