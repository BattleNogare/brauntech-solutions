<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>BraunTech Solutions – Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Hauptlayout -->
    <link rel="stylesheet" href="brauntech.css">
    <!-- Hintergrund / Effekte -->
    <link rel="stylesheet" href="custom.d/background.css">

    <!-- Hintergrund-JS (Punkte, Orbits, Parallax) -->
    <script src="custom.d/background.js" defer></script>

    <!-- YAML Parser (für portal.yaml) -->
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>

    <!-- Portal-spezifische Styles -->
    <style>
        /* Portal-Seite Grundlayout */
        .bt-portal {
            padding-top: 2rem;
            padding-bottom: 3rem;
        }

        /* Container aller Gruppen */
        .bt-portal-groups {
            display: flex;
            flex-direction: column;
            gap: 2.5rem;
            margin-top: 1.5rem;
        }

        /* Gruppe eingerahmt / Card-Style */
        .bt-portal-group {
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 1.5rem 1.75rem;
            background:
                radial-gradient(circle at top left, rgba(57, 255, 20, 0.06), transparent 55%),
                radial-gradient(circle at bottom right, rgba(57, 255, 20, 0.04), transparent 55%),
                #031009f2;
            box-shadow:
                0 18px 45px rgba(0, 0, 0, 0.7),
                0 0 24px rgba(57, 255, 20, 0.12);
        }

        /* Gruppen-Überschrift */
        .bt-portal-group-title {
            font-size: 1.2rem;
            margin: 0 0 1.1rem 0;
            font-family: var(--bt-font-mono);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--green-light);
        }

        /* Grid der Kacheln */
        .bt-portal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.2rem;
        }

        /* Kacheln */
        .bt-portal-tile {
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            aspect-ratio: 1 / 1; /* quadratisch */
            border-radius: 0.75rem;
            text-decoration: none;
            color: #ffffff;
            background-image: linear-gradient(135deg, #444, #111);
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.35);
            transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
        }

        .bt-portal-tile:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 16px 35px rgba(0, 0, 0, 0.5);
            filter: brightness(1.05);
        }

        .bt-portal-tile-logo {
            max-width: 60%;
            max-height: 60%;
            object-fit: contain;
            margin-bottom: 0.5rem;
        }

        .bt-portal-tile-label {
            font-weight: 600;
            letter-spacing: 0.03em;
            text-transform: uppercase;
            font-size: 0.85rem;
            text-align: center;
        }

        .bt-portal-loading,
        .bt-portal-error {
            opacity: 0.8;
            font-size: 0.95rem;
        }

        .bt-portal-error {
            color: #ff8080;
        }

        @media (max-width: 600px) {
            .bt-portal-group {
                padding: 1.25rem 1.4rem;
            }
        }
    </style>
</head>
<body>

<!-- Rotierende Glow-Kreise (werden per JS gefüllt) -->
<div id="bt-glow-orbits"></div>

<!-- Random-Punkte-Layer (werden per JS gefüllt) -->
<div id="bt-points"></div>

<!-- NAVBAR wird automatisch geladen -->
<header class="bt-header" data-include="custom.d/navbar.html"></header>

<main class="bt-main">
    <div class="bt-container bt-portal">
        <h1>Portal</h1>
        <p>Sammlung hilfreicher Links, kuratiert von BraunTech Solutions.</p>

        <!-- Container, den wir per JS aus der portal.yaml füllen -->
        <div id="bt-portal-groups" class="bt-portal-groups">
            <p class="bt-portal-loading">Portal wird geladen …</p>
        </div>
    </div>
</main>

<!-- FOOTER wird automatisch geladen -->
<footer class="bt-footer" data-include="custom.d/footer.html"></footer>

<!-- ============================================
     INCLUDE-SYSTEM FÜR NAVBAR + FOOTER
=============================================== -->
<script>
document.querySelectorAll("[data-include]").forEach(async (el) => {
    const file = el.getAttribute("data-include");
    if (!file) return;

    try {
        const response = await fetch(file);
        if (!response.ok) {
            console.error("Include failed:", file, response.status);
            return;
        }
        const html = await response.text();
        el.innerHTML = html;

        // Jahr aktualisieren (falls Footer mit #bt-year geladen wurde)
        const yearSpan = el.querySelector("#bt-year");
        if (yearSpan) {
            yearSpan.textContent = new Date().getFullYear();
        }
    } catch (e) {
        console.error("Include error:", file, e);
    }
});
</script>

<!-- ============================================
     PORTAL-LOGIK: portal.yaml einlesen und Kacheln erzeugen
=============================================== -->
<script>
(function () {
    const portalContainer = document.getElementById('bt-portal-groups');
    if (!portalContainer) return;

    // Hilfsfunktion: eine Kachel erzeugen
    function createTile(tile) {
        const a = document.createElement('a');
        a.className = 'bt-portal-tile';
        a.href = tile.url;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';

        // Hintergrund aus zwei Farben -> Gradient
        if (tile.colorStart && tile.colorEnd) {
            a.style.backgroundImage = `linear-gradient(135deg, ${tile.colorStart}, ${tile.colorEnd})`;
        }

        // Logo
        if (tile.logo) {
            const img = document.createElement('img');
            img.className = 'bt-portal-tile-logo';
            img.src = 'bilder/' + tile.logo;
            img.alt = tile.label || '';
            a.appendChild(img);
        }

        // Text / Bezeichnung
        const label = document.createElement('div');
        label.className = 'bt-portal-tile-label';
        label.textContent = tile.label || '';
        a.appendChild(label);

        return a;
    }

    // Hilfsfunktion: Gruppe erzeugen
    function createGroup(group) {
        const groupEl = document.createElement('section');
        groupEl.className = 'bt-portal-group';

        if (group.title) {
            const h2 = document.createElement('h2');
            h2.className = 'bt-portal-group-title';
            h2.textContent = group.title;
            groupEl.appendChild(h2);
        }

        const grid = document.createElement('div');
        grid.className = 'bt-portal-grid';

        (group.tiles || []).forEach(tile => {
            grid.appendChild(createTile(tile));
        });

        groupEl.appendChild(grid);
        return groupEl;
    }

    function showError(msg) {
        portalContainer.innerHTML = '';
        const p = document.createElement('p');
        p.className = 'bt-portal-error';
        p.textContent = msg;
        portalContainer.appendChild(p);
    }

    // YAML-Konfigurationsdatei laden
    fetch('custom.d/portal.yaml')
        .then(resp => {
            if (!resp.ok) {
                throw new Error('HTTP ' + resp.status);
            }
            return resp.text(); // YAML als Text laden
        })
        .then(text => {
            let data;
            try {
                data = jsyaml.load(text); // YAML -> JS-Objekt
            } catch (e) {
                console.error('YAML-Parsing-Fehler:', e);
                showError('Portal-Konfiguration ist fehlerhaft (YAML).');
                return;
            }

            portalContainer.innerHTML = '';

            if (!data || !Array.isArray(data.groups) || data.groups.length === 0) {
                showError('Keine Portaleinträge konfiguriert.');
                return;
            }

            data.groups.forEach(group => {
                portalContainer.appendChild(createGroup(group));
            });
        })
        .catch(err => {
            console.error('Fehler beim Laden der Portal-Konfiguration:', err);
            showError('Portal-Konfiguration konnte nicht geladen werden.');
        });

})();
</script>

</body>
</html>
