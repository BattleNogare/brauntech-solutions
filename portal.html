<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>BraunTech Solutions – Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Hauptlayout -->
    <link rel="stylesheet" href="brauntech.css">
    <!-- Hintergrund / Effekte -->
    <link rel="stylesheet" href="custom.d/background.css">

    <!-- Hintergrund-JS (Punkte, Orbits, Parallax) -->
    <script src="custom.d/background.js" defer></script>

    <!-- YAML Parser (für portal.yaml) -->
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>

    <style>
        /* ===========================
           Portal – Zusatzstyles (Header im Box-Stil)
        ============================ */

        .bt-page-portal-header {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .bt-page-portal-header h1 {
            margin: 0;
        }

        .bt-page-portal-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
        }

        .bt-page-portal-meta small {
            color: var(--bt-text-muted, #89a589);
        }

        .bt-page-portal-intro {
            max-width: 720px;
            color: var(--bt-text-muted, #89a589);
        }
    </style>
</head>
<body>

<!-- Rotierende Glow-Kreise (werden per JS gefüllt) -->
<div id="bt-glow-orbits"></div>

<!-- Random-Punkte-Layer (werden per JS gefüllt) -->
<div id="bt-points"></div>

<!-- NAVBAR wird automatisch geladen -->
<header class="bt-header" data-include="custom.d/navbar.html"></header>

<main class="bt-main">
    <div class="bt-container bt-portal">

        <!-- Neuer, einheitlicher Kopfbereich im Box-Stil -->
        <header class="bt-page-portal-header">
            <div class="bt-page-portal-meta">
                <span class="bt-pill">
                    <span class="bt-pill-dot"></span>
                    Portal · Schnellzugriff
                </span>
                <small>BraunTech Solutions · Knuffingen · Hohenstein</small>
            </div>
            <h1>Portal</h1>
            <p class="bt-page-portal-intro">
                Sammlung hilfreicher Links, kuratiert von BraunTech Solutions – für schnellen Zugriff auf
                Tools, Plattformen und Ressourcen rund um Projekte, Recycling &amp; Infrastruktur.
            </p>
        </header>

        <!-- Portal-Gruppen bleiben im eigenen Kachel-Look -->
        <section class="bt-section">
            <!-- Container, den wir per JS aus der portal.yaml füllen -->
            <div id="bt-portal-groups" class="bt-portal-groups">
                <p class="bt-portal-loading">Portal wird geladen …</p>
            </div>
        </section>
    </div>
</main>

<!-- FOOTER wird automatisch geladen -->
<footer class="bt-footer" data-include="custom.d/footer.html"></footer>

<!-- ============================================
     INCLUDE-SYSTEM FÜR NAVBAR + FOOTER (wie auf anderen Seiten)
=============================================== -->
<script>
    // --- Einfacher Include-Loader für Header/Footer ---
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("[data-include]").forEach(function (el) {
            const file = el.getAttribute("data-include");
            if (!file) return;

            fetch(file)
                .then(function (response) {
                    if (!response.ok) throw new Error("Include konnte nicht geladen werden: " + file);
                    return response.text();
                })
                .then(function (html) {
                    el.innerHTML = html;
                })
                .catch(function (err) {
                    console.error(err);
                });
        });
    });

    // Falls dein footer.html ein <span id="bt-year"> enthält:
    (function () {
        var yearEl = document.getElementById('bt-year');
        if (yearEl) {
            yearEl.textContent = new Date().getFullYear();
        }
    })();

    // Slideshow-Script (stört nicht, wenn keine .bt-slideshow auf der Seite ist)
    document.addEventListener('DOMContentLoaded', function () {
        const slideshows = document.querySelectorAll('.bt-slideshow');

        slideshows.forEach(function (slideshow) {
            const images = slideshow.querySelectorAll('.bt-slideshow-images img');
            const dots = slideshow.querySelectorAll('.bt-slideshow-dots button');
            const prevBtn = slideshow.querySelector('.bt-slide-prev');
            const nextBtn = slideshow.querySelector('.bt-slide-next');

            if (!images.length) return;

            let current = 0;
            let autoTimer = null;

            function setActive(index) {
                images.forEach((img, i) => {
                    img.classList.toggle('is-active', i === index);
                });
                dots.forEach((dot, i) => {
                    dot.classList.toggle('is-active', i === index);
                });
                current = index;
            }

            function showNext(step) {
                const count = images.length;
                const newIndex = (current + step + count) % count;
                setActive(newIndex);
            }

            function startAutoPlay() {
                stopAutoPlay();
                autoTimer = setInterval(function () {
                    showNext(1);
                }, 8000);
            }

            function stopAutoPlay() {
                if (autoTimer) {
                    clearInterval(autoTimer);
                    autoTimer = null;
                }
            }

            if (prevBtn) {
                prevBtn.addEventListener('click', function () {
                    stopAutoPlay();
                    showNext(-1);
                    startAutoPlay();
                });
            }

            if (nextBtn) {
                nextBtn.addEventListener('click', function () {
                    stopAutoPlay();
                    showNext(1);
                    startAutoPlay();
                });
            }

            dots.forEach((dot, index) => {
                dot.addEventListener('click', function () {
                    stopAutoPlay();
                    setActive(index);
                    startAutoPlay();
                });
            });

            setActive(0);
            startAutoPlay();
        });
    });
</script>

<!-- ============================================
     PORTAL-LOGIK: portal.yaml einlesen und Kacheln erzeugen
=============================================== -->
<script>
(function () {
    const portalContainer = document.getElementById('bt-portal-groups');
    if (!portalContainer) return;

    // Hilfsfunktion: eine Kachel erzeugen
    function createTile(tile) {
        const a = document.createElement('a');
        a.className = 'bt-portal-tile';
        a.href = tile.url;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';

        // Hintergrund aus zwei Farben -> Gradient
        if (tile.colorStart && tile.colorEnd) {
            a.style.backgroundImage = `linear-gradient(135deg, ${tile.colorStart}, ${tile.colorEnd})`;
        }

        // Logo
        if (tile.logo) {
            const img = document.createElement('img');
            img.className = 'bt-portal-tile-logo';
            img.src = 'bilder/' + tile.logo;
            img.alt = tile.label || '';
            a.appendChild(img);
        }

        // Text / Bezeichnung
        const label = document.createElement('div');
        label.className = 'bt-portal-tile-label';
        label.textContent = tile.label || '';
        a.appendChild(label);

        return a;
    }

    // Hilfsfunktion: Gruppe erzeugen
    function createGroup(group) {
        const groupEl = document.createElement('section');
        groupEl.className = 'bt-portal-group';

        if (group.title) {
            const h2 = document.createElement('h2');
            h2.className = 'bt-portal-group-title';
            h2.textContent = group.title;
            groupEl.appendChild(h2);
        }

        const grid = document.createElement('div');
        grid.className = 'bt-portal-grid';

        (group.tiles || []).forEach(tile => {
            grid.appendChild(createTile(tile));
        });

        groupEl.appendChild(grid);
        return groupEl;
    }

    function showError(msg) {
        portalContainer.innerHTML = '';
        const p = document.createElement('p');
        p.className = 'bt-portal-error';
        p.textContent = msg;
        portalContainer.appendChild(p);
    }

    // YAML-Konfigurationsdatei laden
    fetch('custom.d/portal.yaml')
        .then(resp => {
            if (!resp.ok) {
                throw new Error('HTTP ' + resp.status);
            }
            return resp.text(); // YAML als Text laden
        })
        .then(text => {
            let data;
            try {
                data = jsyaml.load(text); // YAML -> JS-Objekt
            } catch (e) {
                console.error('YAML-Parsing-Fehler:', e);
                showError('Portal-Konfiguration ist fehlerhaft (YAML).');
                return;
            }

            portalContainer.innerHTML = '';

            if (!data || !Array.isArray(data.groups) || data.groups.length === 0) {
                showError('Keine Portaleinträge konfiguriert.');
                return;
            }

            data.groups.forEach(group => {
                portalContainer.appendChild(createGroup(group));
            });
        })
        .catch(err => {
            console.error('Fehler beim Laden der Portal-Konfiguration:', err);
            showError('Portal-Konfiguration konnte nicht geladen werden.');
        });

})();
</script>

</body>
</html>
